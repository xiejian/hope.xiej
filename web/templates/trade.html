{% extends "_utitle.html" %}
{% block head %}
    <script type="text/javascript" src="{{url_for('static',filename='js/trade.js')}}"></script>
    <link type="text/css" href="{{url_for('static',filename='css/trade.css')}}" rel="stylesheet" />
{% endblock %}
{% block content %}
<h3 class="contheader"></h3>
<div class="grid_6">
    <table id="continfo">
    </table>
    <h4>Order Queue</h4>
    <table id="oqueue">
    </table>
    <h4>Transactions</h4>
    <table id="transhis">
    </table>
</div>
<div class="grid_10">
<div class="grid_8 alpha omega push_1 trade B">
    <form action="{{ url_for('trade') }}" method=post>
    <input name=_csrf_token type=hidden value="{{ csrf_token() }}">
    <table><tr><td>  <label id="l_tb" for="t_b">BUY</label><input type="radio" name="b_s" value="B" id="t_b" checked="checked"/>　
        <label id="l_ts" for="t_s">SELL</label><input type="radio" name="b_s" id="t_s" value="S" />　</td>
        <td>        Point:
            <input type=number name="point" value="" size="15" min="0.01" required="required"/><br/></td></tr>
        <tr><td>        <label for="contract">Cont:</label>
            <select id="contract" name="contract_id">
                {% for ck in cont.keys() if cont[ck]['status']=='O' %}
                    <option value={{ck}} {% if ck == default_cid %} selected="selected" {% endif %} >{{cont[ck]['name']}}</option>
                {% endfor %}
            </select></td>
        <td>        Lots:
            <input type=number name="lots" value="" size="15" min="1" required="required"/><br/></td>
        </tr>
    </table>
        <br/><span class="s_toc">　　　</span>　<span class="s_tbs">　</span>
        　　　<input type=submit value=" TRADE ">
</form>
</div>
<div class="clear"></div>
<h4>Active Orders</h4>
    <div id='o_user_grid' class="grid_10 alpha omega" ></div>
<table>
    {% for o in g.u['orders'] %}
        {% if loop.first %}
            <tr><th>Add Time</th><th>Contract</th><th>O/C</th><th>B/S</th><th>Point</th><th>Lots</th><th>Remain Lots</th><th>Value</th><th>Margin</th><th>Cancel</th></tr>
        {% endif %}
        <tr><td>{{ o['createtime'] }}</td><td>{{ cont[o['contract_id']]['name'] }}</td>
            <td><img src="{{url_for('static',filename='img/_i_%s.png'|format(o['type']))}}" title="{{ o['type']|f("F") }}"/></td><td>{{ o['buy_sell']|f("F") }}</td>
            <td>{{ o['point']|f }}</td><td>{{ o['lots'] }}</td><td>{{ o['rm_lots'] }}</td><td>{{ o['value']|f}}</td>
            <td>{{ o.margin|f}}</td>
            <td><form action="{{ url_for('trade') }}" method="POST">
                <input name=_csrf_token type=hidden value="{{ csrf_token() }}"/>
                <input type="hidden" name="orderid" value= {{o['order_id']}} />
                <input type="hidden" name="contract_id" value= {{o['contract_id']}} />
                <INPUT TYPE="image" SRC="{{url_for('static',filename='img/_icon_eject.png')}}" HEIGHT="24" WIDTH="24" BORDER="0" ALT="Submit Form" />
            </form></td></tr>
    {% else %}
        <tr><td>None</td></tr>
    {% endfor %}
</table>

<h4>Current Holding</h4>
    <div id='p_user_grid' class="grid_10 alpha omega"></div>
<table class="tt_pos">
    {% for p in g.u['positions'] %}
        {% if loop.first %}
            <tr><th>Contract</th><th>B/S</th><th>Point</th><th>Lots</th><th>Cost</th><th>MarketValue</th><th>Profit/Loss</th><th>Margin</th><th>Close</th></tr>
        {% endif %}
        <tr>
            <td>{{cont[p.c]['name']}}</td><td>{{p.bs|f("F")}}</td><td>{{p.pt|f}}</td><td>{{p.lt}}</td><td>{{(p.pt * p.lt*cont[p.c]['btc_multi'])|f}}</td>
            <td>{{p.mv|f}}</td><td>{{p.pl|f}}</td><td>{{p.mg|f}}</td>
            <td><a href="{{ url_for('trade',c = p.c) }}"> × </a></td>
        </tr>
    {% else %}
        <tr><td>None</td></tr>
    {% endfor %}
</table>
</div>
<div class="clear"></div>

<!-- overlayed element -->
<div class="modal F" id="cont_overlay">
    <!-- the external content is loaded inside this tag -->
    <div class="cont_wrap"></div>
</div>
{% endblock %}