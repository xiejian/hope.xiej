{% extends "base.html" %}
{% block content %}
<script type="text/javascript" src="{{url_for('static',filename='js/trade.js')}}"></script>
<h3>Trade</h3>
<div class="grid_5">
    <table id="continfo">
    </table>
    <h4>order queue</h4>
    <table id="oqueue">
    </table>
    <h4>transactions</h4>
    <table id="transhis">
    </table>
</div>

<div class="grid_7">
<div class="grid_5 push_1 trade">
    <form action="{{ url_for('trade') }}" method=post>
    <input name=_csrf_token type=hidden value="{{ csrf_token() }}">
    <dl>
        <dd><label for="t_b">BUY</label><input type="radio" name="b_s" value="B" id="t_b" checked="checked"/>
            <label for="t_s">SELL</label><input type="radio" name="b_s" id="t_s" value="S" />
        <dd><label for="t_o">Open</label><input type="radio" name="o_c" value="O" id="t_o" checked="checked" />
            <label for="t_c">Close</label><input type="radio" name="o_c" id="t_c" value="C" />
        <dt><label for="contract">Contract</label>
        <dd><select id="contract" name="contract_id">
                {% for ck in cont.keys() if cont[ck]['status']=='O' %}
                    <option value={{ck}} {% if ck == default_cid %} selected="selected" {% endif %} >{{cont[ck]['name']}}</option>
                {% endfor %}
            </select>
        <dt>Point:
        <dd><input type=number name="point" value="" min="0.01" required="required"/>
        <dt>Lots:
        <dd><input type=number name="lots" value="" min="1" required="required"/>
        <dd><input type=submit value=Trade>
    </dl>
</form>
</div>
<div class="clear"></div>
<h4>Open Orders</h4>
<table>
    <tr><th>Order Time</th><th>Contract</th><th>Open Close</th><th>Buy Sell</th><th>Point</th><th>Lots</th><th>Remain Lots</th><th>Value</th><th>Margin</th><th>Cancel</th></tr>
    {% for o in g.u['orders'] %}
        <tr><<td>{{ o['createtime'] }}</td><td>{{ cont[o['contract_id']]['name'] }}</td><td>{{ o['type'] }}</td><td>{{ o['buy_sell'] }}</td>
            <td>{{ o['point']|f }}</td><td>{{ o['lots'] }}</td><td>{{ o['rm_lots'] }}</td><td>{{ o['value']|f}}</td>
            <td>{{ o.margin|f}}</td>
            <td><form action="{{ url_for('trade') }}" method="POST">
                <input name=_csrf_token type=hidden value="{{ csrf_token() }}"/>
                <input type="hidden" name="orderid" value= {{o['order_id']}} />
                <input type="hidden" name="contract_id" value= {{o['contract_id']}} />
                <button type="submit" value="cancel"> × </button>
            </form></td></tr>
    {% endfor %}
</table>
<hr/>
<h4>Position</h4>
<table>
    <tr><th>Contract</th><th>B/S</th><th>Point</th><th>Lots</th><th>Cost</th><th>MarketValue</th><th>Profit/Loss</th><th>Margin</th><th>Close</th></tr>
    {% for p in g.u['positions'] %}
    <tr>
        <td>{{cont[p.contract_id]['name']}}</td><td>{{p.buy_sell}}</td><td>{{p.point|f}}</td><td>{{p.lots}}</td><td>{{(p.point * p.lots*cont[p.contract_id]['btc_multi'])|f}}</td>
        <td>{{p.marketvalue|f}}</td><td>{{p.p_l|f}}</td><td>{{p.margin|f}}</td>
        <td><a href="{{ url_for('trade',c = p.contract_id) }}"> × </a></td>
    </tr>
    {% else %}
    <tr>None</tr>
    {% endfor %}
</table>
</div>
<!--todo add rich text editor , and picture upload,as a contract info & proof-->
{% endblock %}