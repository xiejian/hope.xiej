{% extends "base.html" %}
{% block content %}
<script type="text/javascript" src="{{url_for('static',filename='js/account.js')}}"></script>
<h4>{{ session['email'] }}</h4>
<h5><ul class="navi" id="accountmenu">
    <li><a href=0>General Info</a></li>
    <li><a href=1>Account History</a></li>
</ul></h5>

<div class="grid_11 push_1 account_tab">
<h5>Current Holding</h5>
<table>
    <tr><th>Contract</th><th>B/S</th><th>Point</th><th>Lots</th><th>Cost</th><th>MarketValue</th><th>Profit/Loss</th><th>Margin</th><th>Close</th></tr>
    {% for p in g.u['positions'] %}
    <tr>
        <td>{{cont[p.contract_id]['name']}}</td><td>{{p.buy_sell}}</td><td>{{p.point|f}}</td><td>{{p.lots}}</td><td>{{(p.point * p.lots*cont[p.contract_id]['btc_multi'])|f}}</td>
        <td>{{p.marketvalue|f}}</td><td>{{p.p_l|f}}</td><td>{{p.margin|f}}</td>
        <td><a href="{{ url_for('trade',c = p.contract_id) }}"> × </a></td>
    </tr>
    {% else %}
    <tr>None</tr>
    {% endfor %}
</table>
<hr/>
<h5>Security Info</h5>
Latest Access Log:
<table>
    <tr><th>Timestamp</th><th>Action</th><th>IP Address</th><th>Approximate Location</th><th>Times</th></tr>
    {% for l in g.u['log'] %}
    <tr>
        <td>{{ l.timestamp }}</td><td>{{ l.action }}</td><td class="ip">{{ l.ip }}</td><td>...</td><td>{{ l.times }}</td>
    </tr>
    {% endfor %}
</table>
Capital Password:{{ g.u['password2'] }}
<div>
    <form action="{{ url_for('account') }}" method=post>
        <input name=_csrf_token type=hidden value="{{ csrf_token() }}">
        <dl>
            <dt>Old Password:
            <dd><input {% if g.u['password2'] %} type=password{% else %} type="hidden" {% endif %} name="opassword" value="" />
            <dt>Password:
            <dd><input type=password name="password" value="" />
            <dt>Confirmed Password:
            <dd><input type=password name="password2" value="" />
            <dd><input type=submit value="SET Capital Password">
        </dl>
    </form>
</div>

Email_validated: {{ g.u['email_v'] }} <br/>

<h5>Referee & Volume</h5>
Your Trade Volume in 30 Days: {{ g.u['tradevol'] |f }} |
Your friends Trade Volume in 30 Days: {{ g.u['rtradevol'] |f }} |
Current Feerate: {{ g.u['feerate'] }}

<p> Recommendate your friends to join BTCFE by fllowing URL: <a href="{{ g.u['referrurl'] }}">{{ g.u['referrurl'] }} </a></p>
<!--todo personal info , if valid, set capital password.-->
<!--todo 发送邀请信，限制名额.-->
Your friend will get 100BTC initial trade volume and 0.1 BTC after his first trade; You will get all this trade volume in the future.
<form action="{{ url_for('account') }}" method=post>
    <input name=_csrf_token type=hidden value="{{ csrf_token() }}">
    <dl>
        <dt>Invite a friend:
        <dd><input type=text name="email" value="" />
        <dd><input type=submit value="Send Invite" {% if not g.u['invite'] %}disabled="disabled"{% endif %}> {{ g.u['invite'] }} left
    </dl>
</form>
</div>

<div class="grid_11 push_1 account_tab">

<h3>Transaction History</h3>
<table>
    <tr><th>TimeStamp</th><th>Contract</th><th>Open/Close</th><th>B/S</th><th>Point</th><th>Lots</th><th>Value</th><th>Fee</th><th>Pofit/Loss</th></tr>
    {% for t in g.u['trans'] %}
    <tr>
        <td>{{t.timestamp}}</td><td>{{cont[t.contract_id]['name']}}</td><td>{{t.type}}</td><td>{{t.buy_sell}}</td>
        <td>{{t.point|f}}</td><td>{{t.lots}}</td><td>{{t.value|f}}</td><td>{{t.fee|f}}</td><td>{{t.p_l|f}}</td>
    </tr>
    {% else %}
    <tr>None</tr>
    {% endfor %}
</table>

<h3>Bitcoin Flow</h3>
<table>
    <tr><th>input_dt</th><th>trans_id</th><th>amount</th><th>type</th></tr>
    {% for b in g.u['btcflow'] %}
    <tr>
        <td>{{b.input_dt}}</td><td>{{b.trans_id}}</td><td>{{b.amount}}</td><td>{{b.type}}</td>
    </tr>
    {% else %}
    <tr>None</tr>
    {% endfor %}
</table>

<h3>Bitcoin Trans</h3>
<table>
    <tr><th>TimeStamp</th><th>type</th><th>amount</th><th>fee</th><th>address</th><th>confirmed</th><th>txid</th></tr>
    {% for t in g.u['btctrans'] %}
    <tr>
        <td>{{t.timestamp}}</td><td>{{t.type}}</td><td>{{t.amount|f}}</td><td>{{t.fee|f}}</td><td>{{t.address}}</td>
        <td>{{t.confirmed|replace(1,"√")|replace(0,"")}}</td><td>{{t.txid}}</td>
    </tr>
    {% else %}
    <tr>None</tr>
    {% endfor %}
</table>

</div>

{% endblock %}